# alfredyang@pharbers.com.
#
# This is job template for Pharbers Max Job

options <- list(
    $options_args
)

find_arg <- function(args, key){
    index <- which(args == key)
    if(length(index) == 0){
        stop(paste("缺失必要参数！", key, sep=""))
    }
    return(args[[min(index)+1]])
}

(main <- function(){
    args <- commandArgs(trailingOnly=TRUE)

    if(length(args) < 2 * length(options))
        stop("缺失必要参数！")

    options <- lapply(options, function(row){
        row[["key"]] <- paste("--", row[["key"]], sep="")
        row[["value"]] <- find_arg(args, row[["key"]])
        row
    })
    args <- lapply(options, function(row) row[["value"]])

    source("phjob.R")
    do.call(execute, args)
})();
